# Information on Upscaling Used for Chummer5a

Last updated: 2023-10-01

## Step-by-Step Guide to Upscaling

Preface: it is extremely helpful to upscale using hardware with a dedicated GPU with Vulkan support. Chummer's images are generally small enough that CPU processing can be good enough (or even older GPUs with very small amounts of VRAM), but YMMV. You will also need roughly 4 GB of storage space.

1. Download and install [chaiNNer](https://chainner.app/download/). ChaiNNer is a robust and flexible program that allows people to easily construct and run neural network-based workflows with a graphical user interface.
2. If you are using a system with multiple GPUs, e.g. a laptop with integrated graphics for power savings and a dedicated GPU for performance applications, it may also be a good idea to manually set chaiNNer to use your dedicated GPU in your Windows Graphics Settings.
3. Run chaiNNer, click the "Manage Dependencies" button in the top-right corner, and then click to install PyTorch. You can also install NCNN and ONNX if you wish to plug in your own upscalers that use these formats, but PyTorch is the important one.
4. After restarting chaiNNer, make sure the GPU you wish to use is selected in chaiNNer's Settings > Python > PyTorch (and NCNN and/or ONNX if you're using those). You can opt to turn FP16 off in these settings because Chummer's images tend to be so small that VRAM won't be an issue (and 32-bit floats will result in better reproducibility than 16-bit ones), but it is not strictly necessary.
5. Depending on whether you want to upscale a single image or an entire folder of images, open either SoloUpscale.chn (for a single image) or BatchUpscale.chn (for a folder) in chaiNNer. Both of these files are located in the same directory as this readme file. These are premade chaiNNer workspaces that have the basic workflow for upscaling already set up for you. You will just need to select a few things manually before you can run them and have them upscale stuff.
6. In the bottom-left corner of the workspace, you will see an orange rectangle titled "Load Model". Click on the "Click to select a file" field inside of that, then navigate to and select 4x_FireAlpha.pth, which should be located in the same directory as this readme file. This is FireAlpha, the machine learning upscaling model that we've used for upscaling so far in Chummer5a and can upscale color images with transparency to four times its original size. If you want to upscale an image to an even larger size, you will need to modify the workflow in chaiNNer to feed the output image of one upscale into another upscaling step. If you wish to use a different upscaling model, this is the box you need to use to select your different model (though if it is saved in a NCNN or ONNX format instead of PyTorch, you will need to drag-and-drop the corresponding "Load Model" module from the left sidebar first and replace the original, PyTorch box with it).
7. You will now need to select the image(s) you wish to upscale. If you are using the solo upscaler workspace, you can do this by clicking the "Click to select file" field in the red rectangle near the top-left corner of the workspace titled "Load Image", then navigating to and selecting the image you want to upscale. If you are using the batch upscaler workspace, you can do this by clicking the "Click to select" field at the top of the large, red rectangle titled "Image File Iterator" that encompasses the whole workspace, then navigating to and selecting the directory containing all the images you want to upscale. By default, only the directory you have selected will be considered, and if you want subdirectories to also be processed, be sure to check the "Recusive" box right under the directory path field that you just clicked.
8. By default, both of these workspaces will shrink your upscaled image to both 48x48 pixels and 64x64 pixels before saving them in directories named "48px" and "64px", respectively (these will be subdirectories of the directory where the original image is located). If you want something else to happen, play around with the settings in the boxes titled "Resize (Resolution)" and "Save Image" on the right side of the workspace. Most controls should be self-evident except for the following:
    * If you wish to "disconnect" a connection-line so that you can, e.g., give custom names or custom directories where you want the final image(s) to be saved, hover over the connection-line you wish to disconnect with your mouse and click on the icon near the middle of it.
    * If you wish to disable a step without outright deleting it, you can toggle whether a rectangle gets processed or not with a play-pause switch located at the bottom-left corner of each rectangle. You can also enable or disable a rectangle by right-clicking anywhere inside of it and selecting the appropriate option in the right-click menu.
    * If you wish to add a process, you can do so by drag-and-dropping the appropriate type of process from the sidebar on the left.
9. When you are ready to begin upscaling, press the "Run" button at the top of the screen (or the F5 key on your keyboard) and wait for the workspace to run to completion.

## Choosing an Upscaling Model

Chummer's icons are generally RGBA pixel art whose originals have a size of 16x16 or 32x32 pixels. This generally limits options for a lot of machine learning-based upscaling, as even the ones trained on pixel art will tend to not support transparency properly (i.e., they are RGB models and not RGBA) and/or they will primarily be focused on upscaling based on larger images. These are also generally the most important considerations when choosing an upscaling model.

## License Information

[FireAlpha](https://openmodeldb.info/models/4x-FireAlpha) is a PyTorch model originally trained on Fire Emblem artwork with transparency by [BlueAmulet](https://github.com/BlueAmulet). It is licensed under [Creative Commons Attribution-NonCommercial 4.0 International](https://creativecommons.org/licenses/by-nc/4.0/).

The chaiNNer workspace files linked here are, unlike most of the rest of the Chummer5a repository, to be considered Public Domain. Feel free to use, modify, and redistribute them however you please.
